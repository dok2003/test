## Моторизированная тележка управляемая по ИК от стандартного пульта ДУ
### Модуль цифровой схемы для опроса АЦП (adc_capture)

Данный модуль посылает сигналы для опроса АЦП [ADC128S052](https://static.chipdip.ru/lib/827/DOC031827742.pdf).
Модуль разработан для платы ["Карно"](https://github.com/Fabmicro-LLC/Karnix_ASB-254/blob/master/Karnix_ASB-254-v1.1/schematics/Karnix_ASB.pdf) на базе Lattice ECP5.

### Запуск на ОС Linux:
1. Установить инструментарий: [YosysHQ](https://github.com/YosysHQ/oss-cad-suite-build/releases/), [OpenFPGALoader](https://github.com/trabucayre/openFPGALoader).
2. Установить make, python: `sudo apt install make python3`
3. В директории adc_capture выполнить `make upload`

### Входные параметры:
* `clk_hz` - тактовая частота ПЛИС (25 МГц для платы "Карно")
* `sclk_hz` - тактовая частота работы АЦП (3.2-8 МГц для ADC128S052);
* `cycle_pause` - количество тактов паузы (`sclk`) между циклами работы АЦП (по умолчанию 10);

### Входные сигналы:
* `clk` - тактовый сигнал;
* `rst` - сигнал сброса;
* `ctl_valid` - сигнал от модуля `control` о его готовности обработать цифровой сигнал; 
* `adc_ack` - сигнал от модуля `control` о завершении обработки цифрового сигнала;
* `address(3-bit)`- адрес входного пина АЦП (`IN0-IN7`);
* `dout_bit` - один бит с выхода `DOUT` АЦП.

### Выходные сигналы:
* `sclk` - сигнал на пин `SCLK` АЦП, тактовый сигнал его работы;
* `cs` - сигнал на пин `~CS` АЦП;
* `adc_ready` - сигнал завершения преобразования аналогового сигнала в цифровой;
* `din_bit` - один бит, поступающий на вход `DIN` АЦП;
* `d_signal(12-bit)` - преобразованный цифровой сигнал.

### Описание работы АЦП:
Один цикл работы АЦП состоит из 16 тактов медленного сигнала `sclk`.Преобразование начинается при подаче на вход `~CS` низкого уровня сигнала (`cs` = 1). 

На вход `DIN` АЦП необходимо подать адрес пина АЦП (8 бит), с которого необходимо считать аналоговый сигнал, в формате `{DC DC DC, address(3-bit), DC DC}`.

Одновременно с этим со входа DOUT необходимо считать результат преобразования (цифровой сигнал 16 бит) прошлого такта в формате `{0000, d_signal(12-bit)}`.

После 16 тактов `sclk` преобразование начинается заново, однако, для предотвращения ошибок и потери данных, сигнал `~CS` необходимо установить в 1 (`cs` = 0) на несколько тактов перед следующим циклом работы. Количество тактов остановки определяется параметром `cycle_pause`.

Ниже представлен рисунок схемы преобразования:

![](https://i.ibb.co/vxFh3NNr/image.png)

### Подключение к пинам на плате "Карно";
Ниже представлен скриншот с изображением УГИ АЦП ADC128S052, а также адреса пинов АЦП, по которым он подключен в ПЛИС:

![image](https://github.com/user-attachments/assets/fe0bfe7f-52b4-4b0a-bbb8-13043d3b8b7f)

![image](https://i.ibb.co/LhsV9h4c/image.png)

### Тестирование модуля:
Для отдельного тестирования модуля предусмотрен top.sv файл, связывающий сигналы с кнопками и светодиодами на плате.
Ниже представлена таблица зависимости нажатия кнопок key[2:0] от сигналов на светодиодах:

| Кнопка (key[2:0]) | Светодиоды (led[3:0])                              | Описание                                   |
|:-----------------:|:---------------------------------------------:|:------------------------------------------:|
| `3'b001`          | `d_signal[3:0]`                               | Отображает младшие 4 бита данных с АЦП    |
| `3'b010`          | `d_signal[7:4]`                               | Отображает 4 бита данных с АЦП (средние)   |
| `3'b011`          | `d_signal[11:8]`                              | Отображает старшие 4 бита данных с АЦП    |
| `3'b100`          | `{1'b0, address}`                             | Отображает 3 бита адреса АЦП с дополнительным нулевым битом |
| `default`         | `{rst, cs, adc_ack, adc_ready}`               | Отображает статусные сигналы            |

